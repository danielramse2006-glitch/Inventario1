<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"><title>Eliminar</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h2 style="text-align:center; background:#c0392b; color:white; padding:15px; margin:0;">Eliminación de objeto</h2>
    <div class="grid-form">
        <div class="col">
            <label class="check-label"><input type="checkbox"> Modelo</label><input type="text" id="m" readonly>
            <label class="check-label"><input type="checkbox"> No. Parte</label><input type="text" id="np" readonly>
            <label class="check-label"><input type="checkbox"> Nombre</label><input type="text" id="n" readonly>
        </div>
        <div class="col">
            <label class="check-label"><input type="checkbox"> Cantidad</label><input type="text" id="c" readonly>
            <label class="check-label"><input type="checkbox"> Costo</label><input type="text" id="co" readonly>
        </div>
        <div class="col">
            <label class="check-label"><input type="checkbox"> Área</label><input type="text" id="u" readonly>
            <label class="check-label"><input type="checkbox"> Estante</label><input type="text" id="e" readonly>
        </div>
        <div class="col">
            <label class="check-label"><input type="checkbox"> Lote</label><input type="text" id="l" readonly>
            <label class="check-label"><input type="checkbox"> Observaciones</label><textarea id="obs" readonly></textarea>
        </div>
        <div class="form-buttons">
            <select id="crit" style="width:150px;"><option value="noParte">No. Parte</option><option value="nombre">Nombre</option></select>
            <input type="text" id="val" placeholder="Dato a buscar...">
            <button id="btnBus" class="btn-action">Buscar</button>
            <button id="btnDel" class="btn-action" style="color:red; border-color:red;">Eliminar</button>
            <button onclick="location.href='index.html'" class="btn-action">Volver</button>
        </div>
    </div>
    <script type="module">
        import { db, checkAuth } from './config.js';
        import { collection, query, where, getDocs, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        checkAuth('eliminar');
        let currentId = null;

        document.getElementById('btnBus').onclick = async () => {
            const crit = document.getElementById('crit').value;
            const val = document.getElementById('val').value.trim();
            const q = query(collection(db, "productos"), where(crit, "==", val));
            const snap = await getDocs(q);
            if(!snap.empty) {
                const d = snap.docs[0].data(); currentId = snap.docs[0].id;
                document.getElementById('m').value = d.modelo; document.getElementById('np').value = d.noParte;
                document.getElementById('n').value = d.nombre; document.getElementById('c').value = d.cantidad;
                document.getElementById('co').value = d.costo; document.getElementById('u').value = d.ubicacion;
                document.getElementById('e').value = d.estante; document.getElementById('l').value = d.lote;
                document.getElementById('obs').value = d.observaciones;
                alert("Objeto encontrado. Verifique antes de borrar.");
            } else { alert("No encontrado"); }
        };

        document.getElementById('btnDel').onclick = async () => {
            if(!currentId) return alert("Busca primero.");
            if(confirm("¿Seguro que deseas eliminarlo permanentemente?")) {
                await deleteDoc(doc(db, "productos", currentId));
                alert("Eliminado"); location.reload();
            }
        };
    </script>
</body>
</html>